<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <title>Stitch Design</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/tailwindcss">
        :root {
            --primary-color: #991b1b;
            --secondary-color: #374151;
            /* --background-color: #111827; */
            --background-color: #0051ff;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
        }
    </style>
    <style>
        #chat-interface {
            display: none;
        }
        /* Hide the camera section by default */
        #camera-section {
            display: none;
        }
        /* Hide the preview section by default */
        #preview-section {
            display: none;
        }
    </style>
</head>
<body class="bg-[var(--background-color)] font-sans">
<div class="relative mx-auto flex h-[calc(100vh-20px)] w-full max-w-md flex-col overflow-hidden bg-[var(--background-color)]" style='font-family: Inter, "Noto Sans", sans-serif;'>
    <div class="flex flex-1 flex-col">
        <header class="sticky top-0 z-10 flex items-center justify-between border-b border-[#233348] bg-[var(--background-color)] p-4">
            <h1 class="text-lg font-bold text-[var(--text-primary)] text-center w-full">SurgiCare Ai</h1>
        </header>

        <!-- Initial Screen -->
        <div class="flex flex-1 flex-col" id="initial-screen">
            <div class="flex flex-1 flex-col items-center justify-center p-4">
                <div class="flex flex-col items-center text-center">
                    <h2 class="text-3xl font-bold text-center text-[var(--text-primary)]">Hi! From SurgiCare.</h2>
                </div>
            </div>
        </div>

        

        <!-- Upload Section (Original) -->
        <div class="sticky bottom-0 bg-[var(--background-color)]">
            <div class="p-4" id="upload-section">
                <div class="flex flex-col items-center gap-4">
                    <!-- Replace the file input label with a camera button -->
                    <button id="open-camera-btn" class="flex flex-col items-center justify-center w-full h-48 border-2 border-dashed border-[var(--secondary-color)] rounded-lg cursor-pointer hover:bg-[var(--secondary-color)]/20">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <span class="material-symbols-outlined text-5xl text-[var(--text-secondary)]">
                                camera_alt
                            </span>
                            <p class="mb-2 text-sm text-[var(--text-secondary)]"><span class="font-semibold">Take a Photo</span></p>
                            <p class="text-xs text-[var(--text-secondary)]">Tap to use your camera</p>
                        </div>
                    </button>
                    <button class="w-full flex h-12 items-center justify-center rounded-full bg-[var(--primary-color)] text-[var(--text-primary)] mt-2">
                        <span class="material-symbols-outlined mr-2"> send </span>
                        Send
                    </button>
                </div>
            </div>

            <!-- Camera Section (Hidden by default) -->
            <div class="p-4" id="camera-section">
                <div class="flex flex-col items-center gap-4">
                    <!-- Video element to display the camera stream -->
                    <video id="video" width="320" height="240" autoplay class="border-2 border-[var(--secondary-color)] rounded-lg"></video>
                    <!-- Button to capture the photo -->
                    <button id="capture-btn" class="w-full flex h-12 items-center justify-center rounded-full bg-[var(--primary-color)] text-[var(--text-primary)] mt-2">
                        <span class="material-symbols-outlined mr-2"> camera </span>
                        Capture Photo
                    </button>
                    <!-- Button to go back to upload section -->
                    <button id="cancel-camera-btn" class="w-full flex h-12 items-center justify-center rounded-full bg-gray-500 text-[var(--text-primary)] mt-2">
                        Cancel
                    </button>
                </div>
            </div>

            <!-- Preview Section (Hidden by default) -->
            <div class="p-4" id="preview-section">
                <div class="flex flex-col items-center gap-4">
                    <!-- Canvas to display the captured image -->
                    <canvas id="canvas" width="320" height="240" class="border-2 border-[var(--secondary-color)] rounded-lg hidden"></canvas>
                    <!-- Image element to display the captured photo -->
                    <img id="captured-image" src="" alt="Captured" class="border-2 border-[var(--secondary-color)] rounded-lg max-w-full h-auto hidden" />
                    <p class="text-sm text-[var(--text-secondary)]">Photo captured! You can retake or send it.</p>
                    <div class="flex gap-2 w-full">
                        <button id="retake-btn" class="flex-1 h-12 items-center justify-center rounded-full bg-gray-500 text-[var(--text-primary)]">
                            Retake
                        </button>
                        <button id="send-photo-btn" class="flex-1 h-12 items-center justify-center rounded-full bg-[var(--primary-color)] text-[var(--text-primary)]">
                            <span class="material-symbols-outlined mr-2"> send </span>
                            Send Photo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Input Bar (Hidden by default) -->
            <div class="hidden flex items-center gap-3 p-4" id="chat-input-bar">
                <div class="flex h-12 flex-1 items-center rounded-full bg-[var(--secondary-color)] px-4">
                    <input class="flex-1 border-none bg-transparent text-[var(--text-primary)] placeholder:text-[var(--text-secondary)] focus:outline-none focus:ring-0" placeholder="Type your message..." type="text"/>
                    <button class="text-[var(--text-secondary)]">
                        <label class="cursor-pointer" for="file-upload">
                            <span class="material-symbols-outlined"> attach_file </span>
                            <input class="sr-only" id="file-upload" name="file-upload" type="file"/>
                        </label>
                    </button>
                </div>
                <button class="flex h-12 w-12 items-center justify-center rounded-full bg-[var(--primary-color)] text-[var(--text-primary)]">
                    <span class="material-symbols-outlined"> send </span>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="flex items-center justify-around border-t border-[#233348] bg-black/50 pb-3 pt-2">
                <a class="flex flex-col items-center gap-1 text-[var(--primary-color)]" href="#">
                    <span class="material-symbols-outlined text-2xl"> forum </span>
                    <span class="text-xs font-medium">Chat</span>
                </a>
                <a class="flex flex-col items-center gap-1 text-[var(--text-secondary)]" href="#">
                    <span class="material-symbols-outlined text-2xl"> history </span>
                    <span class="text-xs font-medium">History</span>
                </a>
            </nav>
        </div>
    </div>
</div>

<script>
    // Get DOM elements
    const openCameraBtn = document.getElementById('open-camera-btn');
    const cancelCameraBtn = document.getElementById('cancel-camera-btn');
    const captureBtn = document.getElementById('capture-btn');
    const retakeBtn = document.getElementById('retake-btn');
    const sendPhotoBtn = document.getElementById('send-photo-btn');

    const uploadSection = document.getElementById('upload-section');
    const cameraSection = document.getElementById('camera-section');
    const previewSection = document.getElementById('preview-section');

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const capturedImage = document.getElementById('captured-image');

    let stream = null; // To hold the camera stream

    // Function to start the camera
    async function startCamera() {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            uploadSection.style.display = 'none';
            cameraSection.style.display = 'block';
        } catch (err) {
            console.error("Error accessing the camera: ", err);
            alert("Could not access the camera. Please ensure you have granted permission and that a camera is available.");
        }
    }

    // Function to stop the camera
    function stopCamera() {
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
            stream = null;
        }
        video.srcObject = null;
    }

    // Function to capture a photo
    function capturePhoto() {
        // Draw the current video frame onto the canvas
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

        // Convert canvas to data URL and set it as the image source
        capturedImage.src = canvas.toDataURL('image/png');
        capturedImage.classList.remove('hidden');

        // Hide camera, show preview
        cameraSection.style.display = 'none';
        previewSection.style.display = 'block';
    }

    // Event Listeners
    openCameraBtn.addEventListener('click', startCamera);
    cancelCameraBtn.addEventListener('click', () => {
        stopCamera();
        cameraSection.style.display = 'none';
        uploadSection.style.display = 'block';
    });
    captureBtn.addEventListener('click', capturePhoto);
    retakeBtn.addEventListener('click', () => {
        previewSection.style.display = 'none';
        startCamera(); // Restart the camera
    });
    sendPhotoBtn.addEventListener('click', () => {
        // Here you would typically send the captured image (capturedImage.src) to your backend or chat
        alert('Photo sent! (Implement your send logic here)');
        // For now, we'll just hide the preview and show the upload section again
        stopCamera();
        previewSection.style.display = 'none';
        uploadSection.style.display = 'block';

        // Optionally, you can simulate adding the photo to the chat here
        // showChat(); // If you have this function defined elsewhere
    });
</script>
</body>
</html>